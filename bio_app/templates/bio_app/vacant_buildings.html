{% load static %}
<!doctype html>
<html lang="en">
<head>
    <meta charset="utf-8" />
    <title>Vacant Buildings - Circular Bioeconomy</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link rel="stylesheet" href="{% static 'css/index.css' %}">
    <link rel="stylesheet" href="{% static 'css/font.css' %}">
    <link rel="stylesheet" href="{% static 'css/styles.css' %}">
    <link rel="stylesheet" href="{% static 'css/components.css' %}">
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.7.1/dist/leaflet.css">

    <style>
        /* Adjust font sizes for table */
        .table-container table {
            font-size: 0.7rem; /* Decrease overall table font size */
        }
    
        /* Decrease header font size slightly */
        .table-container th {
            font-size: 0.75rem;
        }
    
        /* Map and table layout adjustments */
        .content-wrapper {
            display: flex;
            flex-direction: row;
            gap: 20px;
        }
        #map {
            height: 600px;
            width: 30%;
            min-width: 250px;
        }
    
        /* Enable horizontal scroll when needed */
        .table-container {
            width: 70%;
            padding: 5px;
            overflow-x: auto; /* Show horizontal scroll only when needed */
        }
    
        /* Responsive adjustments for smaller screens */
        @media (max-width: 768px) {
            .content-wrapper {
                flex-direction: column;
            }
            #map, .table-container {
                width: 100%;
            }
        }
    </style>
    
    
</head>
<body>
    <div class="f-home">
        {% include "navbar.html" %}
        
        <div class="container mt-5">
            <h1 class="mb-4">Vacant Buildings</h1>
            <p class="lead text-muted">
                Find the perfect space for your business in Pongau! Our platform makes it easy for companies and entrepreneurs to explore available properties, from offices and retail spaces to warehouses and industrial facilities. Discover opportunities that match your needs and connect directly with our administration to express interest and learn more about leasing options.</p>
            <div class="content-wrapper">
                <!-- Map Section -->
                <div id="map"></div>
                
                <!-- Table Section -->
                <div class="table-container">
                    <form method="get" action="{% url 'vacant_buildings' %}" class="form-inline mb-4">
                        <input type="text" name="search" class="form-control mr-2" placeholder="Search buildings..." value="{{ query }}">
                        <button type="submit" class="btn btn-primary">Search</button>
                    </form>
    
                    <table class="table table-striped">
                        <thead>
                            <tr>
                                <th>Name</th>
                                <th>Address</th>
                                <th>Area (sq ft)</th>
                                <th>Floor</th>
                                <th>Available From</th>
                                <th>Construction Year</th>
                                <th>Proposed Purpose</th>
                                <th>Description</th>
                                <th>Action</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for building in page_obj %}
                            <tr>
                                <td>{{ building.name }}</td>
                                <td>{{ building.address }}</td>
                                <td>{{ building.area_sq_ft }}</td>
                                <td>{{ building.floor }}</td>
                                <td>{{ building.available_from }}</td>
                                <td>{{ building.year }}</td>
                                <td>{{ building.proposed_purpose}}</td>
                                <td>{{ building.description }}</td>
                                <td>
                                    <button class="btn btn-outline-primary btn-sm express-interest-btn" 
                                        data-id="{{ building.id }}" 
                                        data-name="{{ building.name }}" 
                                        data-toggle="modal" 
                                        data-target="#expressInterestModal">
                                        Express Interest
                                    </button>
                                </td>
                            </tr>
                            {% empty %}
                            <tr>
                                <td colspan="6" class="text-center">No buildings found.</td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                <!-- Pagination Controls -->
                <nav aria-label="Pagination">
                    <ul class="pagination justify-content-center">
                        {% if page_obj.has_previous %}
                        <li class="page-item">
                            <a class="page-link" href="?page=1{% if query %}&search={{ query }}{% endif %}" aria-label="First">&laquo;&laquo;</a>
                        </li>
                        <li class="page-item">
                            <a class="page-link" href="?page={{ page_obj.previous_page_number }}{% if query %}&search={{ query }}{% endif %}" aria-label="Previous">&laquo;</a>
                        </li>
                        {% else %}
                        <li class="page-item disabled"><a class="page-link">&laquo;&laquo;</a></li>
                        <li class="page-item disabled"><a class="page-link">&laquo;</a></li>
                        {% endif %}

                        <li class="page-item disabled"><span class="page-link">Page {{ page_obj.number }} of {{ page_obj.paginator.num_pages }}</span></li>

                        {% if page_obj.has_next %}
                        <li class="page-item">
                            <a class="page-link" href="?page={{ page_obj.next_page_number }}{% if query %}&search={{ query }}{% endif %}" aria-label="Next">&raquo;</a>
                        </li>
                        <li class="page-item">
                            <a class="page-link" href="?page={{ page_obj.paginator.num_pages }}{% if query %}&search={{ query }}{% endif %}" aria-label="Last">&raquo;&raquo;</a>
                        </li>
                        {% else %}
                        <li class="page-item disabled"><a class="page-link">&raquo;</a></li>
                        <li class="page-item disabled"><a class="page-link">&raquo;&raquo;</a></li>
                        {% endif %}
                    </ul>
                </nav>
                </div>
            </div>
        </div>
    
        {% include "footer.html" %}
    </div>
    
    <!-- Leaflet and JavaScript for Map -->
    <script src="https://unpkg.com/leaflet@1.7.1/dist/leaflet.js"></script>

<!-- Leaflet JS -->
<script src="https://unpkg.com/leaflet@1.7.1/dist/leaflet.js"></script>

<script>
    // Initialize the map
    var map = L.map('map').setView([{{ page_obj.0.latitude|default:"0" }}, {{ page_obj.0.longitude|default:"0" }}], 15);

    // Add OpenStreetMap tile layer
    L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
        maxZoom: 19,
        attribution: '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors'
    }).addTo(map);

    // Add markers for each building
    {% for building in page_obj %}
        var marker = L.marker([{{ building.latitude }}, {{ building.longitude }}]).addTo(map);
        marker.bindPopup(`
            <b>{{ building.name }}</b><br>
            {{ building.address }}<br>
            <strong>Floor:</strong> {{ building.floor }}<br>
            <strong>Area:</strong> {{ building.area_sq_ft }}<br>
            <strong>Purpose:</strong> {{ building.proposed_purpose }}<br>
            <strong>Year of Construction:</strong> {{ building.year }}<br>
            <a href="{% url 'express_interest' building.id %}" style="color: black; font-weight: bold; text-decoration: none; background-color: #C1E0E2; padding: 8px 12px; border-radius: 4px; transition: background-color 0.3s ease;" onmouseover="this.style.backgroundColor='#FFA500'" onmouseout="this.style.backgroundColor='#C1E0E2'">Express Interest</a>
        `);
    {% endfor %}
</script>

<!-- Express Interest Modal -->
<!-- Express Interest Modal -->
<div id="expressInterestModal" class="modal fade" tabindex="-1" role="dialog">
    <div class="modal-dialog modal-dialog-centered" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">Express Interest</h5>
                <button type="button" class="close-modal btn-close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body">
                <p id="modalBuildingInfo">Interested in this property? Fill in the details below and contact the administration.</p>
                <form method="POST" action="{% url 'express_interest' 0 %}" id="expressInterestForm">
                    {% csrf_token %}
                    <input type="hidden" name="building_id" id="modalBuildingId">
                    <div class="form-group">
                        <label for="name">Your Name</label>
                        <input type="text" name="name" class="form-control" required>
                    </div>
                    <div class="form-group">
                        <label for="email">Your Email</label>
                        <input type="email" name="email" class="form-control" required>
                    </div>
                    <div class="form-group">
                        <label for="message">Message</label>
                        <textarea name="message" class="form-control" rows="4" required></textarea>
                    </div>
                    <button type="submit" class="btn btn-primary btn-block">Submit Interest</button>
                </form>
            </div>
        </div>
    </div>
</div>


<!-- Bootstrap and jQuery Scripts -->
<script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>
<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>

<script>

$(document).ready(function () {
    $(".express-interest-btn").click(function () {
        var buildingId = $(this).data("id");
        var buildingName = $(this).data("name");

        $("#modalBuildingInfo").html(`Interested in <b>${buildingName}</b>? Fill in the details below and contact the administration.`);

        // Pass the ID into the form action dynamically
        $("#modalBuildingId").val(buildingId);
        $("#modalBuildingName").text(buildingName);
        $("#expressInterestForm").attr("action", "/express-interest/" + buildingId + "/");

        // Open the modal
        $("#expressInterestModal").modal("show");
    });

    $(".close-modal").click(function () {
        $("#expressInterestModal").modal("hide");
    });
});

</script>


<style>
    /* Style for Close Button */
    .close-modal {
        font-size: 24px;
        font-weight: bold;
        color: black;
        cursor: pointer;
        border: none;
        background: transparent;
    }

    .close-modal:hover {
        color: red;
    }
</style>




    </body>

</html>
